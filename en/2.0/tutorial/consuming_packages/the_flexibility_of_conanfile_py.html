



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Understanding the flexibility of using conanfile.py vs conanfile.txt &mdash; conan 2.0.0-beta documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/conan-favicon.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  


  
    <link rel="stylesheet" href="../../_static/css/signup.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../../_static/css/search.css" type="text/css" />
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="conan 2.0.0-beta documentation" href="../../index.html"/>
        <link rel="up" title="Consuming packages" href="../consuming_packages.html"/>
        <link rel="next" title="How to cross-compile your applications using Conan: host and build contexts" href="cross_building_with_conan.html"/>
        <link rel="prev" title="Building for multiple configurations: Release, Debug, Static and Shared" href="different_configurations.html"/>

 <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WK44ZFM');</script>
<!-- End Google Tag Manager -->
 



</script>


  

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="https://conan.io">
          

          
            
            <img src="../../_static/conan-logo-2.0.png" class="logo" />
          
          </a>

            

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../whatsnew.html">What’s new in Conan 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Install</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../consuming_packages.html">Consuming packages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="build_simple_cmake_project.html">Build a simple CMake project using Conan</a></li>
<li class="toctree-l3"><a class="reference internal" href="use_tools_as_conan_packages.html">Using build tools as Conan packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="different_configurations.html">Building for multiple configurations: Release, Debug, Static and Shared</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Understanding the flexibility of using conanfile.py vs conanfile.txt</a></li>
<li class="toctree-l3"><a class="reference internal" href="cross_building_with_conan.html">How to cross-compile your applications using Conan: host and build contexts</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_to_versioning.html">Introduction to versioning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../creating_packages.html">Creating packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../versioning_ci.html">Versioning and Continuous Integration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

            
          
          <div class="dark_newsletter-div">
             <p>Sign up for release updates:</p>
              <script src="https://app-lon04.marketo.com/js/forms2/js/forms2.min.js"></script>
              <form id="mktoForm_1479"></form>
              <script>MktoForms2.loadForm("https://app-lon04.marketo.com", "256-FNZ-187", 1479);</script>
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">conan</a>
        
      </nav>


      
      <script>
        var reldir = "../../index.html".replace("index.html","").replace("#", "");
      </script>
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation" id="breadcrumbs">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../tutorial.html">Tutorial</a> &raquo;</li>
        
          <li><a href="../consuming_packages.html">Consuming packages</a> &raquo;</li>
        
      <li>Understanding the flexibility of using conanfile.py vs conanfile.txt</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/conan-io/docs/blob/master/tutorial/consuming_packages/the_flexibility_of_conanfile_py.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
</div>
          <!--<select id="search" name="state" multiple="true" onchange="window.location = reldir + this.value;" style="width:90%"></select>
          <hr/>-->
          <!--<div class="admonition important">
            <p class="admonition-title">Announcement</p>
            <p>Conan 2.0 Livestream and Workshop! Join us and get hands on experience upgrading recipes. <a
            href=https://blog.conan.io/2022/10/12/cooking-with-conan-cci-v2-livestream.html> Please refer this blog post for more detail.</a>
          </div>-->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="understanding-the-flexibility-of-using-conanfile-py-vs-conanfile-txt">
<span id="consuming-packages-flexibility-of-conanfile-py"></span><h1>Understanding the flexibility of using conanfile.py vs conanfile.txt<a class="headerlink" href="#understanding-the-flexibility-of-using-conanfile-py-vs-conanfile-txt" title="Permalink to this headline">¶</a></h1>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">In this example, we will retrieve Conan packages from a Conan repository with
packages compatible with Conan 2.0. To run this example successfully you should add this
remote to your Conan configuration (if did not already do it) doing:
<code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">remote</span> <span class="pre">add</span> <span class="pre">conanv2</span> <span class="pre">https://conanv2beta.jfrog.io/artifactory/api/conan/conan</span> <span class="pre">--index</span> <span class="pre">0</span></code></p>
</div>
<p>In the previous examples, we declared our dependencies (<em>Zlib</em> and <em>CMake</em>) in a
<em>conanfile.txt</em> file. Let’s have a look at that file:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><strong>conanfile.txt</strong></span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[requires]</span><span class="w"></span>
<span class="na">zlib/1.2.11</span><span class="w"></span>

<span class="k">[tool_requires]</span><span class="w"></span>
<span class="na">cmake/3.19.8</span><span class="w"></span>

<span class="k">[generators]</span><span class="w"></span>
<span class="na">CMakeDeps</span><span class="w"></span>
<span class="na">CMakeToolchain</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Using a <em>conanfile.txt</em> to build your projects using Conan it’s enough for simple cases,
but if you need more flexibility you should use a <em>conanfile.py</em> file where you can use
Python code to make things such as adding requirements dynamically, changing options
depending on other options or setting options for your requirements. Let’s see an example
on how to migrate to a <em>conanfile.py</em> and use some of those features.</p>
<p>Please, first clone the sources to recreate this project. You can find them in the
<a class="reference external" href="https://github.com/conan-io/examples2">examples2.0 repository</a> in GitHub:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/conan-io/examples2.git
$ <span class="nb">cd</span> examples2/tutorial/consuming_packages/conanfile_py
</pre></div>
</div>
<p>Check the contents of the folder and note that the contents are the same that in the
previous examples but with a <em>conanfile.py</em> instead of a <em>conanfile.txt</em>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>.
├── CMakeLists.txt
├── conanfile.py
└── src
    └── main.c
</pre></div>
</div>
<p>Remember that in the previous examples the <em>conanfile.txt</em> had this information:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><strong>conanfile.txt</strong></span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[requires]</span><span class="w"></span>
<span class="na">zlib/1.2.11</span><span class="w"></span>

<span class="k">[tool_requires]</span><span class="w"></span>
<span class="na">cmake/3.19.8</span><span class="w"></span>

<span class="k">[generators]</span><span class="w"></span>
<span class="na">CMakeDeps</span><span class="w"></span>
<span class="na">CMakeToolchain</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>We will translate that same information to a <em>conanfile.py</em>. This file is what is
typically called a <strong>“Conan recipe”</strong>. It can be used for consuming packages, like in this
case, and also to create packages. For our current case, it will define our requirements
(both libraries and build tools) and logic to modify options and set how we want to
consume those packages. In the case of using this file to create packages, it can define
(among other things) how to download the package’s source code, how to build the binaries
from those sources, how to package the binaries, and information for future consumers on
how to consume the package. We will explain how to use Conan recipes to create
packages in the “Creating Packages” section later.</p>
<p>The equivalent of the <em>conanfile.txt</em> in form of Conan recipe could look like this:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><strong>conanfile.py</strong></span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conan</span> <span class="kn">import</span> <span class="n">ConanFile</span>


<span class="k">class</span> <span class="nc">CompressorRecipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span>
    <span class="n">generators</span> <span class="o">=</span> <span class="s2">&quot;CMakeToolchain&quot;</span><span class="p">,</span> <span class="s2">&quot;CMakeDeps&quot;</span>

    <span class="k">def</span> <span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;zlib/1.2.11&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tool_requires</span><span class="p">(</span><span class="s2">&quot;cmake/3.19.8&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To create the Conan recipe we declared a new class that inherits from the <code class="docutils literal notranslate"><span class="pre">ConanFile</span></code>
class. This class has different class attributes and methods:</p>
<ul class="simple">
<li><strong>settings</strong> this class attribute defines the project-wide variables, like the compiler,
its version, or the OS itself that may change when we build our project. This is related
to how Conan manages binary compatibility as these values will affect the value of the
<strong>package ID</strong> for Conan packages. We will explain how Conan uses this value to manage
binary compatibility later.</li>
<li><strong>generators</strong> this class attribute specifies which Conan generators will be run when we
call the <strong class="command">conan install</strong> command. In this case, we added <strong>CMakeToolchain</strong> and
<strong>CMakeDeps</strong> as in the <em>conanfile.txt</em>.</li>
<li><strong>requirements()</strong> in this method we can use the <code class="docutils literal notranslate"><span class="pre">self.requires()</span></code> and
<code class="docutils literal notranslate"><span class="pre">self.tool_requires()</span></code> methods to declare all our dependencies (libraries and build
tools).</li>
</ul>
<p>You can check that running the same commands as in the previous examples will lead to the
same results as before.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Windows</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan install . --output-folder<span class="o">=</span>build --build<span class="o">=</span>missing
$ <span class="nb">cd</span> build
$ conanbuild.bat
<span class="c1"># assuming Visual Studio 15 2017 is your VS version and that it matches your default profile</span>
$ cmake .. -G <span class="s2">&quot;Visual Studio 15 2017&quot;</span> -DCMAKE_TOOLCHAIN_FILE<span class="o">=</span>conan_toolchain.cmake
$ cmake --build . --config Release
...
Building with CMake version: <span class="m">3</span>.19.8
...
<span class="o">[</span><span class="m">100</span>%<span class="o">]</span> Built target compressor

$ Release<span class="se">\c</span>ompressor.exe
Uncompressed size is: <span class="m">233</span>
Compressed size is: <span class="m">147</span>
ZLIB VERSION: <span class="m">1</span>.2.11
$ deactivate_conanbuild.bat
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Linux, macOS</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan install . --output-folder build --build<span class="o">=</span>missing
$ <span class="nb">cd</span> build
$ <span class="nb">source</span> conanbuild.sh
Capturing current environment <span class="k">in</span> deactivate_conanbuildenv-release-x86_64.sh
Configuring environment variables
$ cmake .. -DCMAKE_TOOLCHAIN_FILE<span class="o">=</span>conan_toolchain.cmake -DCMAKE_BUILD_TYPE<span class="o">=</span>Release
$ cmake --build .
...
Building with CMake version: <span class="m">3</span>.19.8
...
<span class="o">[</span><span class="m">100</span>%<span class="o">]</span> Built target compressor

$ ./compressor
Uncompressed size is: <span class="m">233</span>
Compressed size is: <span class="m">147</span>
ZLIB VERSION: <span class="m">1</span>.2.11
$ <span class="nb">source</span> deactivate_conanbuild.sh
</pre></div>
</div>
</div>
<p>So far we have achieved the same functionality we had using a <em>conanfile.txt</em>, let’s see
how we can take advantage of the capabilities of the <em>conanfile.py</em> to define the project
structure we want to follow and also to add some logic using Conan settings and options.</p>
<div class="section" id="conditional-requirements-using-a-conanfile-py">
<h2>Conditional requirements using a conanfile.py<a class="headerlink" href="#conditional-requirements-using-a-conanfile-py" title="Permalink to this headline">¶</a></h2>
<p>You could add some logic to the <cite>requirements()</cite> method to add or remove requirements
conditionally. Imagine, for example, that you want to add an additional dependency in
Windows or that you want to use the system’s CMake installation instead of using the Conan
<cite>tool_requires</cite>:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">conanfile.py</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conan</span> <span class="kn">import</span> <span class="n">ConanFile</span>


<span class="k">class</span> <span class="nc">CompressorRecipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="c1"># Binary configuration</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span>
    <span class="n">generators</span> <span class="o">=</span> <span class="s2">&quot;CMakeToolchain&quot;</span><span class="p">,</span> <span class="s2">&quot;CMakeDeps&quot;</span>

    <span class="k">def</span> <span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;zlib/1.2.11&quot;</span><span class="p">)</span>
        <span class="c1"># Use the system&#39;s CMake for Windows</span>
        <span class="c1"># and add base64 dependency</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">os</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;base64/0.4.0&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tool_requires</span><span class="p">(</span><span class="s2">&quot;cmake/3.19.8&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-the-layout-method">
<span id="consuming-packages-flexibility-of-conanfile-py-use-layout"></span><h2>Use the layout() method<a class="headerlink" href="#use-the-layout-method" title="Permalink to this headline">¶</a></h2>
<p>In the previous examples, every time we executed a <cite>conan install</cite> command we had to use
the <cite>–output-folder argument</cite> to define where we wanted to create the files that Conan
generates. Also, note that we used a different folder when building in Windows or in
Linux/Macos depending if we were using a multi-config CMake generator or not. You can
define this directly in the <cite>conanfile.py</cite> inside the <cite>layout()</cite> method and make it work
for every platform without adding more changes:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text"><strong>conanfile.py</strong></span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conan</span> <span class="kn">import</span> <span class="n">ConanFile</span>


<span class="k">class</span> <span class="nc">CompressorRecipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span>
    <span class="n">generators</span> <span class="o">=</span> <span class="s2">&quot;CMakeToolchain&quot;</span><span class="p">,</span> <span class="s2">&quot;CMakeDeps&quot;</span>

    <span class="k">def</span> <span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;zlib/1.2.11&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tool_requires</span><span class="p">(</span><span class="s2">&quot;cmake/3.19.8&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># We make the assumption that if the compiler is msvc the</span>
        <span class="c1"># CMake generator is multi-config</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get_safe</span><span class="p">(</span><span class="s2">&quot;compiler&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;msvc&quot;</span><span class="p">:</span>
            <span class="n">multi</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">multi</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">folders</span><span class="o">.</span><span class="n">build</span> <span class="o">=</span> <span class="s2">&quot;build&quot;</span> <span class="k">if</span> <span class="n">multi</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;build/</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">build_type</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folders</span><span class="o">.</span><span class="n">generators</span> <span class="o">=</span> <span class="s2">&quot;build&quot;</span>
</pre></div>
</div>
</div>
<p>As you can see, we defined two different attributes for the Conanfile in the <cite>layout()</cite> method:</p>
<ul class="simple">
<li><strong>self.folders.build</strong> is the folder where the resulting binaries will be placed. The
location depends on the type of CMake generator. For multi-config, they will be located
in a dedicated folder inside the build folder, while for single-config, they will be
located directly in the build folder.</li>
<li><strong>self.folders.generators</strong> is the folder where all the auxiliary files generated by
Conan (CMake toolchain and cmake dependencies files) will be placed.</li>
</ul>
<p>Note that he definitions of the folders is different if it is a multi-config generator
(like Visual Studio), or a single-config generator (like Unix Makefiles). In the
first case, the folder is the same irrespective of the build type, and the build system
will manage the different build types inside that folder. But single-config generators
like Unix Makefiles, must use a different folder for each different configuration (as a
different build_type Release/Debug). In this case we added a simple logic to consider
multi-config if the compiler name is <cite>msvc</cite>.</p>
<p>Check that running the same commands as in the previous examples without the
<cite>–output-folder</cite> argument will lead to the same results as before:</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Windows</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan install . --build<span class="o">=</span>missing
$ <span class="nb">cd</span> build
$ conanbuild.bat
<span class="c1"># assuming Visual Studio 15 2017 is your VS version and that it matches your default profile</span>
$ cmake .. -G <span class="s2">&quot;Visual Studio 15 2017&quot;</span> -DCMAKE_TOOLCHAIN_FILE<span class="o">=</span>conan_toolchain.cmake
$ cmake --build . --config Release
...
Building with CMake version: <span class="m">3</span>.19.8
...
<span class="o">[</span><span class="m">100</span>%<span class="o">]</span> Built target compressor

$ Release<span class="se">\c</span>ompressor.exe
Uncompressed size is: <span class="m">233</span>
Compressed size is: <span class="m">147</span>
ZLIB VERSION: <span class="m">1</span>.2.11
$ deactivate_conanbuild.bat
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Linux, macOS</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conan install . --build<span class="o">=</span>missing
$ <span class="nb">cd</span> build
$ <span class="nb">source</span> conanbuild.sh
Capturing current environment <span class="k">in</span> deactivate_conanbuildenv-release-x86_64.sh
Configuring environment variables
$ cmake .. -DCMAKE_TOOLCHAIN_FILE<span class="o">=</span>conan_toolchain.cmake -DCMAKE_BUILD_TYPE<span class="o">=</span>Release
$ cmake --build .
...
Building with CMake version: <span class="m">3</span>.19.8
...
<span class="o">[</span><span class="m">100</span>%<span class="o">]</span> Built target compressor

$ ./Release/compressor
Uncompressed size is: <span class="m">233</span>
Compressed size is: <span class="m">147</span>
ZLIB VERSION: <span class="m">1</span>.2.11
$ <span class="nb">source</span> deactivate_conanbuild.sh
</pre></div>
</div>
</div>
<p>There’s no need to always write this logic in the <cite>conanfile.py</cite>. There are some
pre-defined layouts you can import and directly use in your recipe. For example, for the
CMake case, there’s a <cite>cmake_layout()</cite> already defined in Conan:</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text"><strong>conanfile.py</strong></span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conan</span> <span class="kn">import</span> <span class="n">ConanFile</span>
<span class="kn">from</span> <span class="nn">conan.tools.cmake</span> <span class="kn">import</span> <span class="n">cmake_layout</span>


<span class="k">class</span> <span class="nc">CompressorRecipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span>
    <span class="n">generators</span> <span class="o">=</span> <span class="s2">&quot;CMakeToolchain&quot;</span><span class="p">,</span> <span class="s2">&quot;CMakeDeps&quot;</span>

    <span class="k">def</span> <span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;zlib/1.2.11&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tool_requires</span><span class="p">(</span><span class="s2">&quot;cmake/3.19.8&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmake_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-the-validate-method-to-raise-an-error-for-non-supported-configurations">
<h2>Use the validate() method to raise an error for non-supported configurations<a class="headerlink" href="#use-the-validate-method-to-raise-an-error-for-non-supported-configurations" title="Permalink to this headline">¶</a></h2>
<p>The <cite>validate()</cite> method is evaluated when Conan loads the <em>conanfile.py</em> and you can use
it to perform checks of the input settings. If, for example, your project does not support
<em>armv8</em> architecture on Macos you can raise the <cite>ConanInvalidConfiguration</cite> exception to
make Conan return with a special error code. This will indicate that the configuration
used for settings or options is not supported.</p>
<p>Use the objects <code class="docutils literal notranslate"><span class="pre">self.info.settings</span></code> and <code class="docutils literal notranslate"><span class="pre">self.info.options</span></code> to read the configuration,
otherwise, the “compatible” packages (method <code class="docutils literal notranslate"><span class="pre">compatibility()</span></code> and plugin <code class="docutils literal notranslate"><span class="pre">compatibility.py</span></code> won’t be able to
verify if the potentially compatible configurations are valid or not.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">conanfile.py</span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="kn">from</span> <span class="nn">conan.errors</span> <span class="kn">import</span> <span class="n">ConanInvalidConfiguration</span>

<span class="k">class</span> <span class="nc">CompressorRecipe</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">os</span> <span class="o">==</span> <span class="s2">&quot;Macos&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">arch</span> <span class="o">==</span> <span class="s2">&quot;armv8&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConanInvalidConfiguration</span><span class="p">(</span><span class="s2">&quot;ARM v8 not supported&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="read-more">
<h2>Read more<a class="headerlink" href="#read-more" title="Permalink to this headline">¶</a></h2>
<div class="examples docutils container">
<ul class="simple">
<li><a class="reference internal" href="../../examples/tools/cmake/cmake_toolchain/build_project_cmake_presets.html#examples-tools-cmake-toolchain-build-project-presets"><span class="std std-ref">Using “cmake_layout” + “CMakeToolchain” + “CMakePresets feature” to build your project</span></a>.</li>
<li>Importing resource files in the generate() method</li>
<li>Layouts advanced use</li>
<li>Conditional generators in configure()</li>
</ul>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cross_building_with_conan.html" class="btn btn-neutral float-right" title="How to cross-compile your applications using Conan: host and build contexts" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="different_configurations.html" class="btn btn-neutral" title="Building for multiple configurations: Release, Debug, Static and Shared" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2022, JFrog.
      Last updated on Nov 11, 2022.
      <span><a href="#" class="ot-sdk-show-settings">Cookies Settings</a></span>
    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <!--<span class="fa fa-pencil-square-o"> Other versions:</span> -->
      Version: 2.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          
            <dd><a href="/en/1.54/index.html">1.54</a></dd>
          
        
          
            <dd><a href="/en/1.53/index.html">1.53</a></dd>
          
        
          
            <dd><a href="/en/1.52/index.html">1.52</a></dd>
          
        
          
            <dd><a href="/en/1.51/index.html">1.51</a></dd>
          
        
          
            <dd><a href="/en/1.50/index.html">1.50</a></dd>
          
        
          
            <dd><a href="/en/1.49/index.html">1.49</a></dd>
          
        
          
            <dd><a href="/en/1.48/index.html">1.48</a></dd>
          
        
          
            <dd><a href="/en/1.47/index.html">1.47</a></dd>
          
        
          
            <dd><a href="/en/1.46/index.html">1.46</a></dd>
          
        
          
            <dd><a href="/en/1.45/index.html">1.45</a></dd>
          
        
          
            <dd><a href="/en/1.44/index.html">1.44</a></dd>
          
        
          
            <dd><a href="/en/1.43/index.html">1.43</a></dd>
          
        
          
            <dd><a href="/en/1.42/index.html">1.42</a></dd>
          
        
          
            <dd><a href="/en/1.41/index.html">1.41</a></dd>
          
        
          
            <dd><a href="/en/1.40/index.html">1.40</a></dd>
          
        
          
            <dd><a href="/en/1.39/index.html">1.39</a></dd>
          
        
          
            <dd><a href="/en/1.38/index.html">1.38</a></dd>
          
        
          
            <dd><a href="/en/1.37/index.html">1.37</a></dd>
          
        
          
            <dd><a href="/en/1.36/index.html">1.36</a></dd>
          
        
          
            <dd><a href="/en/1.35/index.html">1.35</a></dd>
          
        
          
            <dd><a href="/en/1.34/index.html">1.34</a></dd>
          
        
          
            <dd><a href="/en/1.33/index.html">1.33</a></dd>
          
        
          
            <dd><a href="/en/1.32/index.html">1.32</a></dd>
          
        
          
            <dd><a href="/en/1.31/index.html">1.31</a></dd>
          
        
          
            <dd><a href="/en/1.30/index.html">1.30</a></dd>
          
        
          
            <dd><a href="/en/1.29/index.html">1.29</a></dd>
          
        
          
            <dd><a href="/en/1.28/index.html">1.28</a></dd>
          
        
          
            <dd><a href="/en/1.27/index.html">1.27</a></dd>
          
        
          
            <dd><a href="/en/1.26/index.html">1.26</a></dd>
          
        
          
            <dd><a href="/en/1.25/index.html">1.25</a></dd>
          
        
          
            <dd><a href="/en/1.24/index.html">1.24</a></dd>
          
        
          
            <dd><a href="/en/1.23/index.html">1.23</a></dd>
          
        
          
            <dd><a href="/en/1.22/index.html">1.22</a></dd>
          
        
          
            <dd><a href="/en/1.21/index.html">1.21</a></dd>
          
        
          
            <dd><a href="/en/1.20/index.html">1.20</a></dd>
          
        
          
            <dd><a href="/en/1.19/index.html">1.19</a></dd>
          
        
          
            <dd><a href="/en/1.18/index.html">1.18</a></dd>
          
        
          
            <dd><a href="/en/1.17/index.html">1.17</a></dd>
          
        
          
            <dd><a href="/en/1.16/index.html">1.16</a></dd>
          
        
          
            <dd><a href="/en/1.15/index.html">1.15</a></dd>
          
        
          
            <dd><a href="/en/1.14/index.html">1.14</a></dd>
          
        
          
            <dd><a href="/en/1.13/index.html">1.13</a></dd>
          
        
          
            <dd><a href="/en/1.12/index.html">1.12</a></dd>
          
        
          
            <dd><a href="/en/1.11/index.html">1.11</a></dd>
          
        
          
            <dd><a href="/en/1.10/index.html">1.10</a></dd>
          
        
          
            <dd><a href="/en/1.9/index.html">1.9</a></dd>
          
        
          
            <dd><a href="/en/1.8/index.html">1.8</a></dd>
          
        
          
            <dd><a href="/en/1.7/index.html">1.7</a></dd>
          
        
          
            <dd><a href="/en/1.6/index.html">1.6</a></dd>
          
        
          
            <dd><a href="/en/1.5/index.html">1.5</a></dd>
          
        
          
            <dd><a href="/en/1.4/index.html">1.4</a></dd>
          
        
          
            <dd><a href="/en/1.3/index.html">1.3</a></dd>
          
        
          
            <dd><a href="/en/2.0/index.html">2.0</a></dd>
          
        
          
            <dd><a href="/en/latest/index.html">latest</a></dd>
          
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="/en/2.0/conan.pdf">PDF</a></dd>
        
      </dl>
    </div>
  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.0.0-beta',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  <!-- <script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
  <script src="../../_static/js/modernizr.min.js"></script>
  <script src="../../_static/js/search.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
-->
  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  


  <script>
    // initSearch("2.0");
  </script>

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WK44ZFM" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


 


</body>
</html>